/**
 * vue-modal-router v0.5.1
 * (c) 2019 FlynnLee
 * @license MIT
 */
!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("util")):"function"==typeof define&&define.amd?define(["util"],t):o.vueModalRouter=t(o.util)}(this,function(o){"use strict";var t={name:"ModalRouterView",functional:!0,render:function(o,t){var e=t.parent,n=e.$createElement,r=e.$root._modalComponents;return n("div",{},r.map(function(o){return n(o.component,{props:o.props,on:o.on,ModalComponent:o})}))}},e={install:function(o){o.directive("modal-link",{bind:function(o,t,e){o.__modalTo__=t.value;var n=t.arg||"click",r=t.modifiers;o.addEventListener(n,function(t){r.stop&&t.stopPropagation(),r.prevent&&t.preventDefault(),e.context.$modalRouter.push(o.__modalTo__)})},componentUpdated:function(o,t,e){o.__modalTo__=t.value}})}},n=(function(){function o(o){this.value=o}function t(t){function e(o,t){return new Promise(function(e,r){var s={key:o,arg:t,resolve:e,reject:r,next:null};a?a=a.next=s:(i=a=s,n(o,t))})}function n(e,i){try{var a=t[e](i),s=a.value;s instanceof o?Promise.resolve(s.value).then(function(o){n("next",o)},function(o){n("throw",o)}):r(a.done?"return":"normal",a.value)}catch(o){r("throw",o)}}function r(o,t){switch(o){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?n(i.key,i.arg):a=null}var i,a;this._invoke=e,"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(o){return this._invoke("next",o)},t.prototype.throw=function(o){return this._invoke("throw",o)},t.prototype.return=function(o){return this._invoke("return",o)}}(),function(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}),r=function(){function o(o,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}(),i=function(o){return o.replace(/-([a-z])/g,function(o,t){return t.toUpperCase()}).replace(/^[a-z]/,function(o){return o.toUpperCase()})},a=0,s=function(){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n(this,t),this._modals=o,this._root=e,this._modalComponents=[],this._beforeEachOpen=[],this._afterEachClosed=[],this._init()}return r(t,[{key:"_init",value:function(){var o=this;Object.keys(this._modals).forEach(function(t){o._modals[t]._isModal=!0})}},{key:"get",value:function(o){var t=i(o);return this._root?this._modals[o]||this._modals[t]||this._root.get(o):this._modals[o]||this._modals[t]}},{key:"push",value:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=o.name,e=void 0===t?"":t,n=o.props,r=void 0===n?{}:n,i=o.on,s=void 0===i?{}:i,u=this.get(e);if(!u)throw new Error('[vue-modal-router].push can not find modal "'+e+'",register first');var l=a++,c={mid:l,name:e,component:u,props:r,on:s};return this._root&&this._root._beforeEachOpen.forEach(function(o){o(c)}),this._beforeEachOpen.forEach(function(o){o(c)}),this._modalComponents.push(c),l}},{key:"beforeEachOpen",value:function(t){if(!o.isFunction(t))throw new Error("[vue-modal-router] beforeEachOpen should pass function but got "+t);return this._beforeEachOpen.push(t),this}},{key:"afterEachClosed",value:function(t){if(!o.isFunction(t))throw new Error("[vue-modal-router] afterEachClosed should pass function but got "+t);return this._afterEachClosed.push(t),this}},{key:"closeAll",value:function(){for(;this._modalComponents.length;)this._modalComponents.pop()}},{key:"close",value:function(o){var t=this,e=this._modalComponents.find(function(t){return t.mid===o});if(e){var n=e.componentInstance,r=e.model,i=e.delay;if(n){var a=this._modalComponents.findIndex(function(t){return t.mid===o});n.$set(n,r,!1),setTimeout(function(){a>-1&&(t._modalComponents.splice(a,1),t._afterEachClosed.forEach(function(o){o()}),t._root&&t._root._afterEachClosed.forEach(function(o){o()}))},i)}}}}]),t}();return s.install=function(o){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.delay,i=void 0===r?200:r,a=n.model,u=void 0===a?"show":a;o.mixin({beforeCreate:function(){if(this.$root.$options.modalRouter){if(this.$options.modalRouter){var t=[];this.$modalRouter=this.$options.modalRouter,o.util.defineReactive(this,"_modalComponents",t)}else this.$options.modals?this.$modalRouter=new s(this.$options.modals||{},this.$root.$modalRouter):this.$modalRouter=this.$root.$modalRouter;this.$modalRouter._modalComponents=this.$root._modalComponents}},created:function(){var o=this;if(this.$options._isModal){var t=this.$vnode.data.ModalComponent;this[u]=!0,t.componentInstance=this,t.model=u,t.delay=i,this.$watch(u,function(e){if(!e){var n=t.mid;o.$modalRouter.close(n)}})}}}),o.component("modal-router-view",t),o.use(e)},s});
