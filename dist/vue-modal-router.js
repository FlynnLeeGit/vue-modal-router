/**
 * vue-modal-router v0.3.2
 * (c) 2019 FlynnLee
 * @license MIT
 */
!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):o.vueModalRouter=e()}(this,function(){"use strict";var o={name:"ModalLink",props:{tag:{type:String,default:"button"},to:{type:Object,default:function(){return{}},required:!0}},data:function(){return{modalClickHander:null,modalRouteInstance:null,modalRouteModel:""}},methods:{onClick:function(o){o.preventDefault(),this.modalRouteInstance?this.modalRouteInstance[this.modalRouteModel]=!0:this.modalClickHander=function(o,e){o[e.model]=!0}},onMousedown:function(o){var e=this;this.clickHander=null,this.modalRouteInstance=null,0===o.button&&(this.to.autoOpen=!1,this.$modalRouter.push(Object.assign(this.to),function(o,t){e.modalRouteInstance=o,e.modalRouteModel=t.model,e.modalClickHander&&e.modalClickHander(o,t)}))}},created:function(){var o=process&&process.env&&"development"===process.env.NODE_ENV;o&&console.warn("[VueModelRouter] modal-link component is deperated,use directive v-modal-link instead",this.to),this.$modalRouter.has(this.to.name)||o&&console.warn('[VueModalRouter] can not find modal "'+this.to.name+'", please check routes option')},render:function(o){var e={props:this.$attrs};return["a","button","input","div","span"].indexOf(this.tag)>-1?e.on={click:this.onClick,mousedown:this.onMousedown}:e.nativeOn={click:this.onClick,mousedown:this.onMousedown},o(this.tag,e,this.$slots.default)}},e={name:"ModalRouterView",functional:!0,render:function(o,e){var t=e.parent,n=t.$createElement,i=t.$modalComponents;if(i.length){var a=i.map(function(o){return n(o.component,{props:o.props,on:o.on,ModalComponent:o})});return n("div",{class:"vue_modal_router_view_modals"},a)}return n("div",{class:"vue_modal_router_view_empty"})}},t=function(o,e){o.directive("modal-link",{inserted:function(o,t){var n=e.modalRouter;o.__modalTo__=t.value;var i=t.modifiers,a=t.arg||"click";n.has(t.value.name)||process&&process.env&&"development"===process.env.NODE_ENV&&console.warn('[VueModalRouter] can not find modal "'+t.value.name+'", please check routes option'),o.addEventListener(a,function(e){i.stop&&e.stopPropagation(),i.prevent&&e.preventDefault(),n.push(o.__modalTo__)})},update:function(o,e){o.__modalTo__=e.value}})},n=function(o){return"function"==typeof o},i=function(o){return void 0!==o},a=(function(){function o(o){this.value=o}function e(e){function t(o,e){return new Promise(function(t,i){var u={key:o,arg:e,resolve:t,reject:i,next:null};r?r=r.next=u:(a=r=u,n(o,e))})}function n(t,a){try{var r=e[t](a),u=r.value;u instanceof o?Promise.resolve(u.value).then(function(o){n("next",o)},function(o){n("throw",o)}):i(r.done?"return":"normal",r.value)}catch(o){i("throw",o)}}function i(o,e){switch(o){case"return":a.resolve({value:e,done:!0});break;case"throw":a.reject(e);break;default:a.resolve({value:e,done:!1})}a=a.next,a?n(a.key,a.arg):r=null}var a,r;this._invoke=t,"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(o){return this._invoke("next",o)},e.prototype.throw=function(o){return this._invoke("throw",o)},e.prototype.return=function(o){return this._invoke("return",o)}}(),function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}),r=function(){function o(o,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),u=function(){function o(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.routes,r=void 0===n?[]:n,u=t.model,s=void 0===u?"show":u;t.delay;a(this,o),this._routeMap={},this._modalComponents=[],r.forEach(function(o){e._routeMap[o.name]={component:o.component,delay:i(o.delay)?o.delay:200,model:o.model||s,instances:[]}}),this._map={}}return r(o,[{key:"_init",value:function(o){this.app=o}},{key:"has",value:function(o){return o in this._routeMap}},{key:"push",value:function(){var o=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,i=void 0===t?"":t,a=e.props,r=void 0===a?{}:a,u=e.on,s=void 0===u?{}:u,l=e.autoOpen,d=void 0===l||l,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},m=this._routeMap[i];if(!m)throw new Error('[VueModalRouter] can not find modal "'+i+'",register first');if(n(m.component))m.component().then(function(e){e.modalRouteConfig={name:i,delay:m.delay,model:m.model,autoOpen:d};var t={component:e,props:r,on:s,callbacks:{onOpen:c}};o._modalComponents.push(t)});else{m.component.modalRouteConfig={name:i,delay:m.delay,model:m.model,autoOpen:d};var p={component:m.component,props:r,on:s,callbacks:{onOpen:c}};this._modalComponents.push(p)}}},{key:"close",value:function(o){var e=this._modalComponents.indexOf(o);this._modalComponents.splice(e,1)}},{key:"registerInstance",value:function(o,e){this._map[o]=this._map[o]||[],this._map[o].push(e)}},{key:"destroyInstance",value:function(o,e){var t=this._map[o].indexOf(e);this._map[o].splice(t,1),e.$destroy()}}]),o}();return u.install=function(n){var i={modalRouter:null};n.mixin({beforeCreate:function(){if(this.$options.modalRouter){var o=this.$options.modalRouter;i.modalRouter=o,this._modalRouter=o,n._modalRouterInstalled=!0,o._init(this),n.util.defineReactive(this,"_modalComponents",this._modalRouter._modalComponents)}this.$modalRouter||(Object.defineProperty(this,"$modalComponents",{get:function(){return this.$root._modalComponents}}),Object.defineProperty(this,"$modalRouter",{get:function(){return this.$root._modalRouter}}))},created:function(){var o=this;if(this.$options.modalRouteConfig){var e=this.$options.modalRouteConfig,t=e.name,n=e.model,i=e.delay,a=e.autoOpen,r=this.$options._parentVnode.data.ModalComponent;this.$modalRouter.registerInstance(t,this),a&&(this[n]=!0),this.$watch(n,function(e){e||setTimeout(function(){o.$modalRouter.close(r),o.$modalRouter.destroyInstance(t,o)},i)})}},mounted:function(){if(this.$options.modalRouteConfig){var o=this.$options._parentVnode.data.ModalComponent,e=o.callbacks.onOpen;e&&e(this,this.$options.modalRouteConfig)}}}),n.component(o.name,o),n.component(e.name,e),t(n,i)},u});
