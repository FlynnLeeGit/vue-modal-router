/**
 * vue-modal-router v0.6.1
 * (c) 2020 FlynnLee
 * @license MIT
 */
!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("util")):"function"==typeof define&&define.amd?define(["util"],t):o.vueModalRouter=t(o.util)}(this,function(o){"use strict";var t={name:"ModalRouterView",functional:!0,render:function(o,t){var n=t.parent,e=n.$createElement,r=n.$root._modalComponents;return e("div",{},r.map(function(o){return e(o.component,{props:o.props,on:o.on,ModalComponent:o})}))}},n={install:function(o){o.directive("modal-link",{bind:function(o,t,n){o.__modalTo__=t.value;var e=t.arg||"click",r=t.modifiers;o.addEventListener(e,function(t){r.stop&&t.stopPropagation(),r.prevent&&t.preventDefault(),n.context.$modalRouter.push(o.__modalTo__)})},componentUpdated:function(o,t,n){o.__modalTo__=t.value}})}},e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},r=(function(){function o(o){this.value=o}function t(t){function n(o,t){return new Promise(function(n,r){var u={key:o,arg:t,resolve:n,reject:r,next:null};a?a=a.next=u:(i=a=u,e(o,t))})}function e(n,i){try{var a=t[n](i),u=a.value;u instanceof o?Promise.resolve(u.value).then(function(o){e("next",o)},function(o){e("throw",o)}):r(a.done?"return":"normal",a.value)}catch(o){r("throw",o)}}function r(o,t){switch(o){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?e(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(o){return this._invoke("next",o)},t.prototype.throw=function(o){return this._invoke("throw",o)},t.prototype.return=function(o){return this._invoke("return",o)}}(),function(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}),i=function(){function o(o,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}return function(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),t}}(),a=function(o){return"function"==typeof o},u=function(o){return"object"===(void 0===o?"undefined":e(o))&&null!==o},s=function(o){return o.replace(/-([a-z])/g,function(o,t){return t.toUpperCase()}).replace(/^[a-z]/,function(o){return o.toUpperCase()})},l=0,c=function(){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,t),this._modals=o,this._root=n,this._modalComponents=[],this._beforeEachOpen=[],this._afterEachClosed=[]}return i(t,[{key:"get",value:function(o){var t=s(o);return this._root?this._modals[o]||this._modals[t]||this._root.get(o):this._modals[o]||this._modals[t]}},{key:"push",value:function(){var o=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.name,e=void 0===n?"":n,r=t.on,i=void 0===r?{}:r,s=t.props,c=void 0===s?{}:s,f=l++,d=this.get(e);if(!d)throw new Error('[vue-modal-router].push can not find modal "'+e+'",register first');if(u(d))return this._innerPush({name:e,mid:f,component:d,on:i,props:c}),f;if(a(d)){var h=d();return h&&h.then&&h.then(function(t){o._innerPush({name:e,mid:f,component:t.default||t,on:i,props:c})}),f}}},{key:"_innerPush",value:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=o.mid,n=o.name,e=o.on,r=void 0===e?{}:e,i=o.component,a=void 0===i?{}:i,u=o.props,s=void 0===u?{}:u,l={mid:t,name:n,component:a,props:s,on:r};this._root&&this._root._beforeEachOpen.forEach(function(o){o(l)}),this._beforeEachOpen.forEach(function(o){o(l)}),this._modalComponents.push(l)}},{key:"beforeEachOpen",value:function(t){if(!o.isFunction(t))throw new Error("[vue-modal-router] beforeEachOpen should pass function but got "+t);return this._beforeEachOpen.push(t),this}},{key:"afterEachClosed",value:function(t){if(!o.isFunction(t))throw new Error("[vue-modal-router] afterEachClosed should pass function but got "+t);return this._afterEachClosed.push(t),this}},{key:"closeAll",value:function(){for(;this._modalComponents.length;)this._modalComponents.pop()}},{key:"close",value:function(o){var t=this,n=this._modalComponents.find(function(t){return t.mid===o});if(n){var e=n.componentInstance,r=n.model,i=n.delay;if(e){var a=this._modalComponents.findIndex(function(t){return t.mid===o});e.$set(e,r,!1),setTimeout(function(){a>-1&&(t._modalComponents.splice(a,1),t._afterEachClosed.forEach(function(o){o()}),t._root&&t._root._afterEachClosed.forEach(function(o){o()}))},i)}}}}]),t}();return c.install=function(o){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.delay,i=void 0===r?200:r,a=e.model,u=void 0===a?"show":a;o.mixin({beforeCreate:function(){if(this.$root.$options.modalRouter){if(this.$options.modalRouter){var t=[];this.$modalRouter=this.$options.modalRouter,o.util.defineReactive(this,"_modalComponents",t)}else this.$options.modals?this.$modalRouter=new c(this.$options.modals||{},this.$root.$modalRouter):this.$modalRouter=this.$root.$modalRouter;this.$modalRouter._modalComponents=this.$root._modalComponents}},created:function(){var o=this;if(this.$vnode&&this.$vnode.data&&this.$vnode.data.ModalComponent){var t=this.$vnode.data.ModalComponent;this[u]=!0,t.componentInstance=this,t.model=u,t.delay=i,this.$watch(u,function(n){if(!n){var e=t.mid;o.$modalRouter.close(e)}})}}}),o.component("modal-router-view",t),o.use(n)},c});
